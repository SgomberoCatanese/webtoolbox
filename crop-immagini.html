<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ritaglia Immagini con Cropper.js - WebToolbox.fun</title>

<!-- Cropper.js CSS da CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet"/>

<style>
  /* Stile base e navbar */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #eee;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  nav {
    background-color: #1db954;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  nav .logo {
    font-weight: bold;
    font-size: 1.4rem;
    color: #121212;
  }
  nav ul {
    display: flex;
    gap: 1rem;
    list-style: none;
    flex-wrap: wrap;
    margin: 0;
  }
  nav a {
    color: #121212;
    text-decoration: none;
    font-weight: bold;
  }
  nav a.active {
    text-decoration: underline;
  }
  main {
    max-width: 700px;
    margin: 2rem auto;
    padding: 0 1rem;
    flex: 1;
  }
  h1 {
    text-align: center;
    margin-bottom: 0.3rem;
  }
  p.description {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #aaa;
  }
  input[type="file"] {
    display: block;
    margin: 0 auto 1.5rem;
    cursor: pointer;
    border-radius: 6px;
    padding: 0.6rem 1.2rem;
    border: none;
    background-color: #1db954;
    color: #121212;
    font-weight: bold;
  }
  #imageContainer {
    max-width: 100%;
    max-height: 400px;
    margin: 0 auto;
    display: none;
    border: 2px solid #1db954;
    border-radius: 8px;
  }
  #imageContainer img {
    max-width: 100%;
    display: block;
    max-height: 400px;
  }
  #cropBtn {
    display: block;
    margin: 1.5rem auto 0;
    background-color: #1db954;
    border: none;
    padding: 0.8rem 1.8rem;
    font-weight: bold;
    font-size: 1.1rem;
    color: #121212;
    border-radius: 6px;
    cursor: pointer;
  }
  #resultContainer {
    margin-top: 2rem;
    text-align: center;
  }
  #resultContainer img {
    max-width: 100%;
    max-width: 300px;
    border-radius: 8px;
    border: 2px solid #1db954;
  }
  footer {
    background-color: #1e1e1e;
    text-align: center;
    padding: 1rem;
    font-size: 0.9rem;
    color: #aaa;
  }
</style>
</head>
<body>
<nav>
  <div class="logo">ðŸ§° WebToolbox.fun</div>
  <ul>
    <li><a href="index.html">Converti Immagini</a></li>
    <li><a href="ridimensiona.html">Ridimensiona</a></li>
    <li><a href="ruota-immagini.html">Ruota</a></li>
    <li><a href="flip-immagini.html">Specchia</a></li>
    <li><a href="crop-immagini.html" class="active">Ritaglia</a></li>
    <li><a href="base64.html">Img â†’ Base64</a></li>
    <li><a href="scala-grigi.html">Scala di Grigi</a></li>
  </ul>
</nav>

<main>
  <h1>Ritaglia Immagini</h1>
  <p class="description">Carica un'immagine, seleziona l'area e scarica il ritaglio.</p>
  <input type="file" id="inputImage" accept="image/*" />
  <div id="imageContainer">
    <img id="image" alt="Carica un'immagine per ritagliare" />
  </div>
  <button id="cropBtn" style="display:none;">Ritaglia e Scarica</button>
  <div id="resultContainer"></div>
</main>

<footer>
  <p>Creato da Boss & MbareGPT â€“ WebToolbox.fun</p>
</footer>

<!-- Cropper.js JS da CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script>
  const inputImage = document.getElementById('inputImage');
  const image = document.getElementById('image');
  const imageContainer = document.getElementById('imageContainer');
  const cropBtn = document.getElementById('cropBtn');
  const resultContainer = document.getElementById('resultContainer');

  let cropper = null;

  inputImage.addEventListener('change', e => {
    const files = e.target.files;
    if (!files || !files.length) return;

    const file = files[0];
    if (!file.type.startsWith('image/')) return alert('Seleziona un file immagine valido.');

    const url = URL.createObjectURL(file);
    image.src = url;
    resultContainer.innerHTML = '';
    cropBtn.style.display = 'none';

    if (cropper) {
      cropper.destroy();
      cropper = null;
    }

    imageContainer.style.display = 'block';

    image.onload = () => {
      cropper = new Cropper(image, {
        viewMode: 1,
        autoCropArea: 0.7,
        movable: true,
        zoomable: true,
        rotatable: false,
        scalable: false,
        responsive: true,
        background: false,
        modal: true,
        guides: true,
      });
      cropBtn.style.display = 'block';
    };
  });

  cropBtn.addEventListener('click', () => {
    if (!cropper) return;
    cropper.getCroppedCanvas().toBlob(blob => {
      const url = URL.createObjectURL(blob);
      resultContainer.innerHTML = `
        <p>Immagine ritagliata:</p>
        <a href="${url}" download="immagine-ritagliata.png">Scarica PNG</a><br>
        <img src="${url}" alt="Immagine ritagliata" />
      `;
    }, 'image/png');
  });
</script>
</body>
</html>
