<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Condividi File Online - WebToolbox.fun</title>
  <meta name="description" content="Condividi file di qualsiasi tipo e dimensione online. Crea un codice univoco, genera QR code e trasferisci file in modo sicuro." />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
  <style>
    /*
      Stile CSS con estetica iOS e logica mobile avanzata
      Supporto per tema chiaro/scuro
    */

    /* Reset e Stili Globali */
    :root {
      /* Tema Scuro (default) */
      --bg-primary: #000000;
      --bg-secondary: #1C1C1E;
      --bg-tertiary: #2C2C2E;
      --text-primary: #F2F2F7;
      --text-secondary: #AEAEB2;
      --text-tertiary: #8E8E93;
      --accent-color: #0A84FF;
      --border-color: rgba(84, 84, 88, 0.65);
      --nav-bg: rgba(28, 28, 30, 0.75);
      --card-bg: #1C1C1E;
      --input-bg: #2C2C2E;
      --success-color: #30D158;
      --warning-color: #FF9F0A;
      --error-color: #FF453A;
      --gradient-bg: linear-gradient(135deg, rgba(10, 132, 255, 0.1) 0%, rgba(48, 209, 88, 0.1) 100%);
    }

    [data-theme="light"] {
      /* Tema Chiaro */
      --bg-primary: #FFFFFF;
      --bg-secondary: #F2F2F7;
      --bg-tertiary: #E5E5EA;
      --text-primary: #000000;
      --text-secondary: #3A3A3C;
      --text-tertiary: #6D6D70;
      --accent-color: #007AFF;
      --border-color: rgba(60, 60, 67, 0.29);
      --nav-bg: rgba(248, 248, 248, 0.94);
      --card-bg: #FFFFFF;
      --input-bg: #F2F2F7;
      --success-color: #34C759;
      --warning-color: #FF9500;
      --error-color: #FF3B30;
      --gradient-bg: linear-gradient(135deg, rgba(0, 122, 255, 0.1) 0%, rgba(52, 199, 89, 0.1) 100%);
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    /* --- Navigazione --- */
    nav {
      background: var(--nav-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 0.5px solid var(--border-color);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 20;
    }

    nav .logo {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--text-primary);
    }

    nav ul {
      display: flex;
      gap: 1.5rem;
      list-style: none;
      flex-wrap: wrap;
      margin: 0;
    }

    nav a {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 500;
      transition: opacity 0.2s ease-in-out;
    }

    nav a:hover {
      opacity: 0.7;
    }

    nav a.active {
      color: var(--text-primary);
      font-weight: 600;
    }
    
    #mobile-menu-trigger {
      display: none;
    }

    /* Controlli tema e lingua */
    .nav-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .theme-toggle, .lang-selector {
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.5rem;
      color: var(--text-primary);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .theme-toggle:hover, .lang-selector:hover {
      background: var(--bg-tertiary);
    }

    /* --- Contenuto Principale --- */
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1.5rem 4rem 1.5rem;
      width: 100%;
      box-sizing: border-box;
      flex: 1;
    }

    h1 {
      text-align: center;
      margin-bottom: 0.5rem;
      font-size: 2.5rem;
      font-weight: 700;
    }

    .subtitle {
      text-align: center;
      margin-bottom: 2.5rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Tabs per Invia/Ricevi */
    .tab-container {
      display: flex;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 4px;
      margin-bottom: 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .tab {
      flex: 1;
      padding: 1rem;
      text-align: center;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      color: var(--text-secondary);
    }

    .tab.active {
      background: var(--accent-color);
      color: #FFFFFF;
      transform: scale(1.02);
    }

    /* Sezioni contenuto */
    .content-section {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .content-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Card principale */
    .main-card {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--border-color);
    }

    /* Upload area */
    .upload-area {
      border: 2px dashed var(--border-color);
      border-radius: 20px;
      padding: 3rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--gradient-bg);
      margin-bottom: 2rem;
    }

    .upload-area:hover, .upload-area.dragover {
      border-color: var(--accent-color);
      background: var(--gradient-bg);
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--accent-color);
    }

    .upload-text {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .upload-subtext {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* File info */
    .file-info {
      background: var(--input-bg);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1rem 0;
      display: none;
    }

    .file-info.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .file-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .file-size {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Form controls */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .form-group input {
      width: 100%;
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.3);
    }

    /* Buttons */
    .btn {
      background: var(--accent-color);
      border: none;
      color: #FFFFFF;
      padding: 1rem 2rem;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.2s ease-in-out;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
      min-width: 150px;
    }

    .btn:hover {
      transform: scale(1.05);
      filter: brightness(1.1);
    }

    .btn:disabled {
      background: var(--text-tertiary);
      cursor: not-allowed;
      transform: none;
      filter: none;
    }

    .btn-secondary {
      background: var(--input-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-success {
      background: var(--success-color);
    }

    .btn-full {
      width: 100%;
      margin: 1rem 0;
    }

    /* Share info */
    .share-info {
      background: var(--input-bg);
      border-radius: 20px;
      padding: 2rem;
      margin: 2rem 0;
      text-align: center;
      display: none;
    }

    .share-info.show {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .share-code {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
      margin: 1rem 0;
      letter-spacing: 2px;
      font-family: 'Courier New', monospace;
    }

    .share-url {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
      word-break: break-all;
      font-family: monospace;
      border: 1px solid var(--border-color);
    }

    /* QR Code */
    .qr-container {
      background: #FFFFFF;
      border-radius: 16px;
      padding: 1rem;
      margin: 1.5rem auto;
      display: inline-block;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    #qrcode {
      display: flex;
      justify-content: center;
    }

    /* Action buttons */
    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 2rem 0;
    }

    /* Receive section */
    .receive-input {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
      align-items: flex-end;
    }

    .receive-input input {
      flex: 1;
    }

    /* Status messages */
    .status-message {
      padding: 1rem;
      border-radius: 12px;
      margin: 1rem 0;
      text-align: center;
      font-weight: 500;
      display: none;
    }

    .status-success {
      background: rgba(48, 209, 88, 0.1);
      color: var(--success-color);
      border: 1px solid var(--success-color);
    }

    .status-error {
      background: rgba(255, 69, 58, 0.1);
      color: var(--error-color);
      border: 1px solid var(--error-color);
    }

    .status-info {
      background: rgba(10, 132, 255, 0.1);
      color: var(--accent-color);
      border: 1px solid var(--accent-color);
    }

    /* Progress bar */
    .progress-container {
      background: var(--input-bg);
      border-radius: 10px;
      height: 8px;
      margin: 1rem 0;
      overflow: hidden;
      display: none;
    }

    .progress-bar {
      background: var(--accent-color);
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 10px;
    }

    /* Hidden elements */
    .hidden {
      display: none !important;
    }

    input[type="file"] {
      display: none;
    }

    /* === STILI VERSIONE MOBILE === */
    @media (max-width: 768px) {
      nav ul {
        display: none;
        position: absolute;
        top: 65px;
        right: 1.5rem;
        width: 250px;
        background: var(--nav-bg);
        backdrop-filter: blur(24px) saturate(180%);
        -webkit-backdrop-filter: blur(24px) saturate(180%);
        border-radius: 14px;
        border: 1px solid var(--border-color);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        padding: 0.5rem 0;
        flex-direction: column;
        gap: 0;
        z-index: 100;
      }
      
      nav ul.mobile-menu-active { display: flex; }
      
      nav ul li { width: 100%; }
      nav ul li a {
        display: block;
        padding: 0.9rem 1.25rem;
        color: var(--text-primary);
        font-weight: 400;
        border-bottom: 0.5px solid var(--border-color);
      }
      nav ul li:last-child a { border-bottom: none; }
      nav ul li a.active { background-color: var(--accent-color); color: #FFFFFF; }
      
      #mobile-menu-trigger {
        display: block;
        background: none;
        border: none;
        padding: 0.5rem;
        cursor: pointer;
      }
      #mobile-menu-trigger svg { width: 24px; height: 24px; fill: var(--accent-color); }

      h1 { font-size: 2rem; }
      main { padding: 0 1rem 4rem 1rem; }
      .main-card { padding: 1.5rem; }
      .upload-area { padding: 2rem 1rem; }
      .action-buttons { flex-direction: column; }
      .receive-input { flex-direction: column; gap: 1rem; }
      .nav-controls { gap: 0.5rem; }
      .theme-toggle, .lang-selector { padding: 0.4rem; font-size: 0.8rem; }
    }

    /* Animazioni aggiuntive */
    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .bounce {
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }
  </style>
</head>
<body>
<nav>
  <div class="logo">🧰 WebToolbox.fun</div>
  <ul>
    <li><a href="index.html">Converti</a></li>
    <li><a href="ridimensiona.html">Ridimensiona</a></li>
    <li><a href="ruota-immagini.html">Ruota</a></li>
    <li><a href="flip-immagini.html">Specchia</a></li>
    <li><a href="crop-immagini.html">Ritaglia</a></li>
    <li><a href="base64.html">Base64</a></li>
    <li><a href="scala-grigi.html">Filtri</a></li>
    <li><a href="share.html" class="active">Condividi</a></li>
  </ul>
  <div class="nav-controls">
    <select class="lang-selector" id="langSelector">
      <option value="it">🇮🇹 IT</option>
      <option value="en">🇬🇧 EN</option>
      <option value="fr">🇫🇷 FR</option>
      <option value="de">🇩🇪 DE</option>
      <option value="es">🇪🇸 ES</option>
    </select>
    <button class="theme-toggle" id="themeToggle">🌙</button>
  </div>
  <button id="mobile-menu-trigger" aria-label="Apri menu">
    <svg viewBox="0 0 100 80" width="40" height="40">
      <circle cx="50" cy="10" r="8"/><circle cx="50" cy="40" r="8"/><circle cx="50" cy="70" r="8"/>
    </svg>
  </button>
</nav>

<main>
  <h1 data-translate="title">Condividi File</h1>
  <p class="subtitle" data-translate="subtitle">Trasferisci file di qualsiasi tipo e dimensione in modo sicuro e veloce</p>

  <!-- Tab Navigation -->
  <div class="tab-container">
    <div class="tab active" id="sendTab" data-translate="send_tab">📤 Invia</div>
    <div class="tab" id="receiveTab" data-translate="receive_tab">📥 Ricevi</div>
  </div>

  <!-- Send Section -->
  <div class="content-section active" id="sendSection">
    <div class="main-card">
      <!-- Upload Area -->
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">📁</div>
        <div class="upload-text" data-translate="upload_text">Trascina il file qui o clicca per selezionare</div>
        <div class="upload-subtext" data-translate="upload_subtext">Qualsiasi tipo di file, senza limiti di dimensione</div>
      </div>
      
      <input type="file" id="fileInput" />
      
      <!-- File Info -->
      <div class="file-info" id="fileInfo">
        <div class="file-name" id="fileName"></div>
        <div class="file-size" id="fileSize"></div>
      </div>

      <!-- Password Form -->
      <div class="form-group">
        <label for="passwordInput" data-translate="password_label">Password (opzionale)</label>
        <input type="password" id="passwordInput" placeholder="Lascia vuoto per generare un codice automatico" data-translate-placeholder="password_placeholder" />
      </div>

      <!-- Send Button -->
      <button class="btn btn-full" id="sendBtn" disabled data-translate="send_button">
        📤 Invia File
      </button>

      <!-- Progress Bar -->
      <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <!-- Status Messages -->
      <div class="status-message" id="statusMessage"></div>
    </div>

    <!-- Share Info -->
    <div class="share-info" id="shareInfo">
      <h3 data-translate="share_ready">File pronto per la condivisione!</h3>
      
      <div class="share-code" id="shareCode"></div>
      
      <div class="qr-container">
        <div id="qrcode"></div>
      </div>
      
      <div class="share-url" id="shareUrl"></div>
      
      <div class="action-buttons">
        <button class="btn btn-secondary" id="copyCodeBtn" data-translate="copy_code">📋 Copia Codice</button>
        <button class="btn btn-secondary" id="copyUrlBtn" data-translate="copy_url">🔗 Copia Link</button>
        <button class="btn btn-secondary" id="shareBtn" data-translate="share_button">📱 Condividi</button>
      </div>
      
      <p class="upload-subtext" data-translate="share_expires">Il file sarà disponibile per 24 ore</p>
    </div>
  </div>

  <!-- Receive Section -->
  <div class="content-section" id="receiveSection">
    <div class="main-card">
      <h3 data-translate="receive_title">Ricevi File</h3>
      <p data-translate="receive_description">Inserisci il codice ricevuto per scaricare il file</p>
      
      <div class="receive-input">
        <input type="text" id="receiveCodeInput" placeholder="Inserisci il codice" data-translate-placeholder="receive_placeholder" />
        <button class="btn" id="receiveBtn" data-translate="receive_button">📥 Ricevi</button>
      </div>
      
      <div class="form-group">
        <label for="receivePasswordInput" data-translate="receive_password_label">Password (se richiesta)</label>
        <input type="password" id="receivePasswordInput" placeholder="Inserisci la password" data-translate-placeholder="receive_password_placeholder" />
      </div>
      
      <!-- Status Messages -->
      <div class="status-message" id="receiveStatusMessage"></div>
      
      <!-- Download Info -->
      <div class="file-info" id="downloadInfo">
        <div class="file-name" id="downloadFileName"></div>
        <div class="file-size" id="downloadFileSize"></div>
        <button class="btn btn-success btn-full" id="downloadBtn" data-translate="download_button">
          ⬇️ Scarica File
        </button>
      </div>
    </div>
  </div>
</main>

<script>
// Traduzioni
const translations = {
  it: {
    title: "Condividi File",
    subtitle: "Trasferisci file di qualsiasi tipo e dimensione in modo sicuro e veloce",
    send_tab: "📤 Invia",
    receive_tab: "📥 Ricevi",
    upload_text: "Trascina il file qui o clicca per selezionare",
    upload_subtext: "Qualsiasi tipo di file, senza limiti di dimensione",
    password_label: "Password (opzionale)",
    password_placeholder: "Lascia vuoto per generare un codice automatico",
    send_button: "📤 Invia File",
    share_ready: "File pronto per la condivisione!",
    copy_code: "📋 Copia Codice",
    copy_url: "🔗 Copia Link",
    share_button: "📱 Condividi",
    share_expires: "Il file sarà disponibile per 24 ore",
    receive_title: "Ricevi File",
    receive_description: "Inserisci il codice ricevuto per scaricare il file",
    receive_placeholder: "Inserisci il codice",
    receive_button: "📥 Ricevi",
    receive_password_label: "Password (se richiesta)",
    receive_password_placeholder: "Inserisci la password",
    download_button: "⬇️ Scarica File"
  },
  en: {
    title: "Share Files",
    subtitle: "Transfer files of any type and size securely and quickly",
    send_tab: "📤 Send",
    receive_tab: "📥 Receive",
    upload_text: "Drag file here or click to select",
    upload_subtext: "Any file type, no size limits",
    password_label: "Password (optional)",
    password_placeholder: "Leave empty to generate automatic code",
    send_button: "📤 Send File",
    share_ready: "File ready to share!",
    copy_code: "📋 Copy Code",
    copy_url: "🔗 Copy Link",
    share_button: "📱 Share",
    share_expires: "File will be available for 24 hours",
    receive_title: "Receive File",
    receive_description: "Enter the received code to download the file",
    receive_placeholder: "Enter the code",
    receive_button: "📥 Receive",
    receive_password_label: "Password (if required)",
    receive_password_placeholder: "Enter password",
    download_button: "⬇️ Download File"
  },
  fr: {
    title: "Partager des Fichiers",
    subtitle: "Transférez des fichiers de tout type et taille de manière sécurisée et rapide",
    send_tab: "📤 Envoyer",
    receive_tab: "📥 Recevoir",
    upload_text: "Glissez le fichier ici ou cliquez pour sélectionner",
    upload_subtext: "Tout type de fichier, sans limite de taille",
    password_label: "Mot de passe (optionnel)",
    password_placeholder: "Laissez vide pour générer un code automatique",
    send_button: "📤 Envoyer le Fichier",
    share_ready: "Fichier prêt à partager!",
    copy_code: "📋 Copier le Code",
    copy_url: "🔗 Copier le Lien",
    share_button: "📱 Partager",
    share_expires: "Le fichier sera disponible pendant 24 heures",
    receive_title: "Recevoir un Fichier",
    receive_description: "Entrez le code reçu pour télécharger le fichier",
    receive_placeholder: "Entrez le code",
    receive_button: "📥 Recevoir",
    receive_password_label: "Mot de passe (si requis)",
    receive_password_placeholder: "Entrez le mot de passe",
    download_button: "⬇️ Télécharger le Fichier"
  },
  de: {
    title: "Dateien Teilen",
    subtitle: "Übertragen Sie Dateien jeder Art und Größe sicher und schnell",
    send_tab: "📤 Senden",
    receive_tab: "📥 Empfangen",
    upload_text: "Datei hier hinziehen oder klicken zum Auswählen",
    upload_subtext: "Jeder Dateityp, keine Größenbeschränkung",
    password_label: "Passwort (optional)",
    password_placeholder: "Leer lassen für automatischen Code",
    send_button: "📤 Datei Senden",
    share_ready: "Datei bereit zum Teilen!",
    copy_code: "📋 Code Kopieren",
    copy_url: "🔗 Link Kopieren",
    share_button: "📱 Teilen",
    share_expires: "Datei wird 24 Stunden verfügbar sein",
    receive_title: "Datei Empfangen",
    receive_description: "Geben Sie den erhaltenen Code ein, um die Datei herunterzuladen",
    receive_placeholder: "Code eingeben",
    receive_button: "📥 Empfangen",
    receive_password_label: "Passwort (falls erforderlich)",
    receive_password_placeholder: "Passwort eingeben",
    download_button: "⬇️ Datei Herunterladen"
  },
  es: {
    title: "Compartir Archivos",
    subtitle: "Transfiere archivos de cualquier tipo y tamaño de forma segura y rápida",
    send_tab: "📤 Enviar",
    receive_tab: "📥 Recibir",
    upload_text: "Arrastra el archivo aquí o haz clic para seleccionar",
    upload_subtext: "Cualquier tipo de archivo, sin límites de tamaño",
    password_label: "Contraseña (opcional)",
    password_placeholder: "Deja vacío para generar código automático",
    send_button: "📤 Enviar Archivo",
    share_ready: "¡Archivo listo para compartir!",
    copy_code: "📋 Copiar Código",
    copy_url: "🔗 Copiar Enlace",
    share_button: "📱 Compartir",
    share_expires: "El archivo estará disponible por 24 horas",
    receive_title: "Recibir Archivo",
    receive_description: "Ingresa el código recibido para descargar el archivo",
    receive_placeholder: "Ingresa el código",
    receive_button: "📥 Recibir",
    receive_password_label: "Contraseña (si es requerida)",
    receive_password_placeholder: "Ingresa la contraseña",
    download_button: "⬇️ Descargar Archivo"
  }
};

// Variables globales
let currentFile = null;
let currentShareCode = null;
let currentLang = 'it';
let isDarkTheme = true;

// Elementos del DOM
const elements = {
  // Navigation
  sendTab: document.getElementById('sendTab'),
  receiveTab: document.getElementById('receiveTab'),
  sendSection: document.getElementById('sendSection'),
  receiveSection: document.getElementById('receiveSection'),
  
  // Upload
  uploadArea: document.getElementById('uploadArea'),
  fileInput: document.getElementById('fileInput'),
  fileInfo: document.getElementById('fileInfo'),
  fileName: document.getElementById('fileName'),
  fileSize: document.getElementById('fileSize'),
  
  // Send
  passwordInput: document.getElementById('passwordInput'),
  sendBtn: document.getElementById('sendBtn'),
  progressContainer: document.getElementById('progressContainer'),
  progressBar: document.getElementById('progressBar'),
  statusMessage: document.getElementById('statusMessage'),
  
  // Share info
  shareInfo: document.getElementById('shareInfo'),
  shareCode: document.getElementById('shareCode'),
  shareUrl: document.getElementById('shareUrl'),
  copyCodeBtn: document.getElementById('copyCodeBtn'),
  copyUrlBtn: document.getElementById('copyUrlBtn'),
  shareBtn: document.getElementById('shareBtn'),
  
  // Receive
  receiveCodeInput: document.getElementById('receiveCodeInput'),
  receivePasswordInput: document.getElementById('receivePasswordInput'),
  receiveBtn: document.getElementById('receiveBtn'),
  receiveStatusMessage: document.getElementById('receiveStatusMessage'),
  downloadInfo: document.getElementById('downloadInfo'),
  downloadFileName: document.getElementById('downloadFileName'),
  downloadFileSize: document.getElementById('downloadFileSize'),
  downloadBtn: document.getElementById('downloadBtn'),
  
  // Controls
  langSelector: document.getElementById('langSelector'),
  themeToggle: document.getElementById('themeToggle')
};

// Simulazione database in memoria (in produzione usare un vero database)
const fileDatabase = new Map();

// Inizializzazione
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
  setupEventListeners();
  updateLanguage();
});

function initializeApp() {
  // Controlla tema salvato
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'light') {
    toggleTheme();
  }
  
  // Controlla lingua salvata
  const savedLang = localStorage.getItem('language');
  if (savedLang && translations[savedLang]) {
    currentLang = savedLang;
    elements.langSelector.value = savedLang;
  }
  
  // Controlla se c'è un codice nell'URL
  const urlParams = new URLSearchParams(window.location.search);
  const shareCode = urlParams.get('code');
  if (shareCode) {
    switchToReceive();
    elements.receiveCodeInput.value = shareCode;
  }
}

function setupEventListeners() {
  // Tab navigation
  elements.sendTab.addEventListener('click', switchToSend);
  elements.receiveTab.addEventListener('click', switchToReceive);
  
  // Upload
  elements.uploadArea.addEventListener('click', () => elements.fileInput.click());
  elements.uploadArea.addEventListener('dragover', handleDragOver);
  elements.uploadArea.addEventListener('dragleave', handleDragLeave);
  elements.uploadArea.addEventListener('drop', handleDrop);
  elements.fileInput.addEventListener('change', handleFileSelect);
  
  // Send
  elements.sendBtn.addEventListener('click', handleSendFile);
  
  // Share actions
  elements.copyCodeBtn.addEventListener('click', copyShareCode);
  elements.copyUrlBtn.addEventListener('click', copyShareUrl);
  elements.shareBtn.addEventListener('click', shareFile);
  
  // Receive
  elements.receiveBtn.addEventListener('click', handleReceiveFile);
  elements.downloadBtn.addEventListener('click', handleDownloadFile);
  
  // Controls
  elements.langSelector.addEventListener('change', handleLanguageChange);
  elements.themeToggle.addEventListener('click', toggleTheme);
  
  // Mobile menu
  setupMobileMenu();
}

function setupMobileMenu() {
  const mobileMenuTrigger = document.getElementById('mobile-menu-trigger');
  const navUl = document.querySelector('nav ul');

  if (mobileMenuTrigger && navUl) {
    mobileMenuTrigger.addEventListener('click', (event) => {
      event.stopPropagation();
      navUl.classList.toggle('mobile-menu-active');
    });

    document.addEventListener('click', (event) => {
      if (navUl.classList.contains('mobile-menu-active') && !navUl.contains(event.target)) {
        navUl.classList.remove('mobile-menu-active');
      }
    });
  }
}

// Tab switching
function switchToSend() {
  elements.sendTab.classList.add('active');
  elements.receiveTab.classList.remove('active');
  elements.sendSection.classList.add('active');
  elements.receiveSection.classList.remove('active');
}

function switchToReceive() {
  elements.receiveTab.classList.add('active');
  elements.sendTab.classList.remove('active');
  elements.receiveSection.classList.add('active');
  elements.sendSection.classList.remove('active');
}

// File upload handlers
function handleDragOver(e) {
  e.preventDefault();
  elements.uploadArea.classList.add('dragover');
}

function handleDragLeave(e) {
  e.preventDefault();
  elements.uploadArea.classList.remove('dragover');
}

function handleDrop(e) {
  e.preventDefault();
  elements.uploadArea.classList.remove('dragover');
  
  const files = e.dataTransfer.files;
  if (files.length > 0) {
    handleFile(files[0]);
  }
}

function handleFileSelect(e) {
  const files = e.target.files;
  if (files.length > 0) {
    handleFile(files[0]);
  }
}

function handleFile(file) {
  currentFile = file;
  
  // Mostra info file
  elements.fileName.textContent = file.name;
  elements.fileSize.textContent = formatFileSize(file.size);
  elements.fileInfo.classList.add('show');
  
  // Abilita pulsante invio
  elements.sendBtn.disabled = false;
  
  // Animazione
  elements.fileInfo.classList.add('bounce');
  setTimeout(() => elements.fileInfo.classList.remove('bounce'), 500);
}

function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Send file
async function handleSendFile() {
  if (!currentFile) return;
  
  elements.sendBtn.disabled = true;
  elements.progressContainer.style.display = 'block';
  
  try {
    // Simula upload con progress
    await simulateUpload();
    
    // Genera codice condivisione
    const shareCode = generateShareCode();
    const password = elements.passwordInput.value || null;
    
    // Salva nel "database"
    const fileData = {
      file: currentFile,
      password: password,
      timestamp: Date.now(),
      downloads: 0
    };
    
    fileDatabase.set(shareCode, fileData);
    currentShareCode = shareCode;
    
    // Mostra info condivisione
    showShareInfo(shareCode);
    
    showStatus('success', 'File caricato con successo!');
    
  } catch (error) {
    showStatus('error', 'Errore durante il caricamento del file');
    elements.sendBtn.disabled = false;
  }
  
  elements.progressContainer.style.display = 'none';
}

function simulateUpload() {
  return new Promise((resolve) => {
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 15;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        resolve();
      }
      elements.progressBar.style.width = progress + '%';
    }, 200);
  });
}

function generateShareCode() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let result = '';
  for (let i = 0; i < 6; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
}

function showShareInfo(shareCode) {
  elements.shareCode.textContent = shareCode;
  
  // Genera URL
  const shareUrl = `${window.location.origin}${window.location.pathname}?code=${shareCode}`;
  elements.shareUrl.textContent = shareUrl;
  
  // Genera QR Code
  document.getElementById('qrcode').innerHTML = '';
  QRCode.toCanvas(document.getElementById('qrcode'), shareUrl, {
    width: 200,
    margin: 2,
    color: {
      dark: '#000000',
      light: '#FFFFFF'
    }
  });
  
  elements.shareInfo.classList.add('show');
  elements.shareInfo.classList.add('pulse');
  setTimeout(() => elements.shareInfo.classList.remove('pulse'), 2000);
}

// Share actions
function copyShareCode() {
  navigator.clipboard.writeText(currentShareCode).then(() => {
    showStatus('success', 'Codice copiato negli appunti!');
    elements.copyCodeBtn.classList.add('bounce');
    setTimeout(() => elements.copyCodeBtn.classList.remove('bounce'), 500);
  });
}

function copyShareUrl() {
  const shareUrl = `${window.location.origin}${window.location.pathname}?code=${currentShareCode}`;
  navigator.clipboard.writeText(shareUrl).then(() => {
    showStatus('success', 'Link copiato negli appunti!');
    elements.copyUrlBtn.classList.add('bounce');
    setTimeout(() => elements.copyUrlBtn.classList.remove('bounce'), 500);
  });
}

function shareFile() {
  const shareUrl = `${window.location.origin}${window.location.pathname}?code=${currentShareCode}`;
  
  if (navigator.share) {
    navigator.share({
      title: 'File condiviso - WebToolbox.fun',
      text: `Scarica il file usando questo codice: ${currentShareCode}`,
      url: shareUrl
    });
  } else {
    // Fallback: copia URL
    copyShareUrl();
  }
}

// Receive file
function handleReceiveFile() {
  const code = elements.receiveCodeInput.value.trim().toUpperCase();
  const password = elements.receivePasswordInput.value;
  
  if (!code) {
    showReceiveStatus('error', 'Inserisci un codice valido');
    return;
  }
  
  const fileData = fileDatabase.get(code);
  
  if (!fileData) {
    showReceiveStatus('error', 'Codice non valido o file scaduto');
    return;
  }
  
  // Controlla password se richiesta
  if (fileData.password && fileData.password !== password) {
    showReceiveStatus('error', 'Password non corretta');
    return;
  }
  
  // Controlla scadenza (24 ore)
  const now = Date.now();
  const fileAge = now - fileData.timestamp;
  const maxAge = 24 * 60 * 60 * 1000; // 24 ore
  
  if (fileAge > maxAge) {
    showReceiveStatus('error', 'File scaduto');
    fileDatabase.delete(code);
    return;
  }
  
  // Mostra info download
  elements.downloadFileName.textContent = fileData.file.name;
  elements.downloadFileSize.textContent = formatFileSize(fileData.file.size);
  elements.downloadInfo.classList.add('show');
  
  // Salva riferimento per download
  elements.downloadBtn.onclick = () => downloadFile(fileData.file);
  
  showReceiveStatus('success', 'File trovato! Clicca per scaricare');
}

function downloadFile(file) {
  const url = URL.createObjectURL(file);
  const a = document.createElement('a');
  a.href = url;
  a.download = file.name;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showReceiveStatus('success', 'Download avviato!');
}

// Status messages
function showStatus(type, message) {
  elements.statusMessage.className = `status-message status-${type}`;
  elements.statusMessage.textContent = message;
  elements.statusMessage.style.display = 'block';
  
  setTimeout(() => {
    elements.statusMessage.style.display = 'none';
  }, 5000);
}

function showReceiveStatus(type, message) {
  elements.receiveStatusMessage.className = `status-message status-${type}`;
  elements.receiveStatusMessage.textContent = message;
  elements.receiveStatusMessage.style.display = 'block';
  
  setTimeout(() => {
    elements.receiveStatusMessage.style.display = 'none';
  }, 5000);
}

// Language handling
function handleLanguageChange() {
  currentLang = elements.langSelector.value;
  localStorage.setItem('language', currentLang);
  updateLanguage();
}

function updateLanguage() {
  const texts = translations[currentLang];
  
  document.querySelectorAll('[data-translate]').forEach(element => {
    const key = element.getAttribute('data-translate');
    if (texts[key]) {
      element.textContent = texts[key];
    }
  });
  
  document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
    const key = element.getAttribute('data-translate-placeholder');
    if (texts[key]) {
      element.placeholder = texts[key];
    }
  });
}

// Theme handling
function toggleTheme() {
  isDarkTheme = !isDarkTheme;
  
  if (isDarkTheme) {
    document.body.removeAttribute('data-theme');
    elements.themeToggle.textContent = '🌙';
    localStorage.setItem('theme', 'dark');
  } else {
    document.body.setAttribute('data-theme', 'light');
    elements.themeToggle.textContent = '☀️';
    localStorage.setItem('theme', 'light');
  }
}

// Cleanup expired files (eseguito ogni ora)
setInterval(() => {
  const now = Date.now();
  const maxAge = 24 * 60 * 60 * 1000; // 24 ore
  
  for (const [code, fileData] of fileDatabase.entries()) {
    if (now - fileData.timestamp > maxAge) {
      fileDatabase.delete(code);
    }
  }
}, 60 * 60 * 1000); // Ogni ora
</script>
</body>
</html>