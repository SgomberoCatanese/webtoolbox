<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editor Filtri Immagini – WebToolbox.fun</title>
  <meta name="description" content="Applica scala di grigi, seppia, inverti e altri filtri. Regola luminosità, contrasto, saturazione, temperatura e scarica l'immagine." />
  <style>
    body { background: #121212; color: #eee; font-family: sans-serif; margin: 0; }
    nav { background: #1db954; padding: 1rem; display: flex; justify-content: space-between; flex-wrap: wrap; }
    nav .logo { font-weight: bold; font-size: 1.4rem; color: #121212; }
    nav ul { list-style: none; display: flex; gap: 1rem; flex-wrap: wrap; margin: 0; padding: 0; }
    nav a { text-decoration: none; color: #121212; font-weight: bold; }
    main { max-width: 900px; margin: 2rem auto; padding: 1rem; }
    h1, p { text-align: center; }
    canvas { max-width: 100%; border-radius: 8px; margin: 1rem auto; display: block; }
    .controls { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin: 1rem 0; }
    .controls label { display: flex; flex-direction: column; font-size: 0.9rem; text-align: center; }
    input[type=range] { width: 120px; }
    select, input[type=file], button { padding: 0.5rem; border-radius: 5px; border: none; background: #1db954; color: #121212; font-weight: bold; cursor: pointer; }
    button { margin: 0.5rem; }
  </style>
</head>
<body>
  <nav>
    <div class="logo">WebToolbox.fun</div>
    <ul>
      <li><a href="index.html">Converti</a></li>
      <li><a href="ridimensiona.html">Ridimensiona</a></li>
      <li><a href="ruota-immagini.html">Ruota</a></li>
      <li><a href="flip-immagini.html">Specchia</a></li>
      <li><a href="crop-immagini.html">Ritaglia</a></li>
      <li><a href="base64.html">Base64</a></li>
      <li><a href="scala-grigi.html" class="active">Filtri</a></li>
    </ul>
  </nav>

  <main>
    <h1>Editor Filtri e Colori</h1>
    <p>Carica una foto e applica filtri: scala grigi, seppia, inverti... oppure modifica luminosità, contrasto e altro.</p>

    <input type="file" accept="image/*" id="upload" />
    <canvas id="canvas"></canvas>

    <div class="controls">
      <label>Filtro:
        <select id="filterSelect">
          <option value="none">Nessuno</option>
          <option value="grayscale(100%)">Scala Grigi</option>
          <option value="sepia(100%)">Seppia</option>
          <option value="invert(100%)">Inverti</option>
          <option value="saturate(200%)">Saturazione+</option>
        </select>
      </label>
      <label>Luminosità
        <input type="range" min="50" max="200" value="100" id="brightness" />
      </label>
      <label>Contrasto
        <input type="range" min="50" max="200" value="100" id="contrast" />
      </label>
      <label>Saturazione
        <input type="range" min="0" max="300" value="100" id="saturate" />
      </label>
      <label>Blur
        <input type="range" min="0" max="10" value="0" id="blur" />
      </label>
      <label>Temperatura
        <input type="range" min="-100" max="100" value="0" id="temp" />
      </label>
    </div>

    <button id="applyBtn">Applica modifiche</button>
    <button id="downloadBtn">Scarica Immagine</button>
  </main>

  <script>
    const upload = document.getElementById('upload');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const filterSelect = document.getElementById('filterSelect');
    const brightness = document.getElementById('brightness');
    const contrast = document.getElementById('contrast');
    const saturate = document.getElementById('saturate');
    const blur = document.getElementById('blur');
    const temp = document.getElementById('temp');
    const downloadBtn = document.getElementById('downloadBtn');
    const applyBtn = document.getElementById('applyBtn');

    let img = new Image();
    let originalURL = null;

    upload.addEventListener('change', e => {
      const reader = new FileReader();
      reader.onload = function(event) {
        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          originalURL = event.target.result;
          applyFilters();
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    function applyFilters() {
      if (!originalURL) return;
      const tempImg = new Image();
      tempImg.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.filter = `
          ${filterSelect.value}
          brightness(${brightness.value}%)
          contrast(${contrast.value}%)
          saturate(${saturate.value}%)
          blur(${blur.value}px)
        `;
        ctx.drawImage(tempImg, 0, 0);

        if (parseInt(temp.value) !== 0) {
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          for (let i = 0; i < data.length; i += 4) {
            if (temp.value > 0) data[i] = Math.min(255, data[i] + parseInt(temp.value));      // più rosso
            if (temp.value < 0) data[i+2] = Math.min(255, data[i+2] + Math.abs(temp.value));  // più blu
          }
          ctx.putImageData(imageData, 0, 0);
        }

        ctx.filter = 'none'; // resetta
      };
      tempImg.src = originalURL;
    }

    [filterSelect, brightness, contrast, saturate, blur, temp].forEach(input => {
      input.addEventListener('input', applyFilters);
    });

    applyBtn.addEventListener('click', () => {
      filterSelect.value = 'none';
      applyFilters();
    });

    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'filtrata.png';
      link.href = canvas.toDataURL();
      link.click();
    });
  </script>
</body>
</html>
