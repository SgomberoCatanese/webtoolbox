<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ruota immagini online con multitasking e interazione â€“ WebToolbox.fun</title>
  <meta name="description" content="Ruota immagini JPG, PNG online gratis. Supporto multi-file con rotazioni singole, o rotazione libera per un'immagine con mouse/touch." />
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    nav {
      background-color: #1db954;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    nav .logo {
      font-weight: bold;
      font-size: 1.4rem;
      color: #121212;
    }
    nav ul {
      display: flex;
      gap: 1rem;
      list-style: none;
      flex-wrap: wrap;
      margin: 0;
    }
    nav a {
      color: #121212;
      text-decoration: none;
      font-weight: bold;
    }
    nav a.active {
      text-decoration: underline;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
      flex: 1;
    }
    h1 {
      text-align: center;
      margin-bottom: 0.3rem;
    }
    p.description {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #aaa;
    }
    #banner {
      background-color: #1db954;
      color: #121212;
      padding: 0.8rem 1rem;
      border-radius: 6px;
      text-align: center;
      font-weight: 700;
      margin-bottom: 1rem;
      display: none;
    }
    input[type="file"] {
      display: block;
      margin: 0 auto 1rem;
      cursor: pointer;
      border-radius: 6px;
      padding: 0.6rem 1.2rem;
      border: none;
      background-color: #1db954;
      color: #121212;
      font-weight: bold;
      max-width: 320px;
    }
    button {
      display: block;
      margin: 1rem auto 2rem;
      padding: 0.7rem 1.5rem;
      background-color: #1db954;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      color: #121212;
      max-width: 220px;
    }
    #multiContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-bottom: 2rem;
    }
    .multiItem {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 150px;
      border: 2px solid #1db954;
      padding: 10px;
      border-radius: 8px;
      background: #222;
    }
    .multiItem img {
      max-width: 100%;
      border-radius: 6px;
      margin-bottom: 10px;
      cursor: default;
    }
    .multiItem select, .multiItem input[type="number"] {
      width: 100%;
      margin-top: 5px;
      padding: 6px 8px;
      border-radius: 6px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      background-color: #1db954;
      color: #121212;
      text-align: center;
    }
    #singleContainer {
      display: none;
      flex-direction: column;
      align-items: center;
      border: 2px solid #1db954;
      border-radius: 8px;
      padding: 15px;
      background: #222;
      margin-bottom: 2rem;
    }
    #singleImg {
      max-width: 90vw;
      max-height: 60vh;
      border-radius: 8px;
      cursor: grab;
      user-select: none;
      transition: transform 0.1s ease-out;
    }
    #singleRotationValue {
      margin-top: 10px;
      font-weight: bold;
      color: #1db954;
    }
    #resultContainer {
      text-align: center;
      margin-top: 1rem;
    }
    #resultContainer img {
      max-width: 100%;
      border-radius: 8px;
      border: 2px solid #1db954;
      margin-bottom: 0.5rem;
    }
    #resultContainer a {
      display: block;
      margin-bottom: 1rem;
      font-weight: bold;
      color: #1db954;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
<nav>
  <div class="logo">ðŸ§° WebToolbox.fun</div>
  <ul>
    <li><a href="index.html">Converti Immagini</a></li>
    <li><a href="ridimensiona.html">Ridimensiona</a></li>
    <li><a href="ruota-immagini.html" class="active">Ruota</a></li>
    <li><a href="flip-immagini.html">Specchia</a></li>
    <li><a href="crop-immagini.html">Ritaglia</a></li>
    <li><a href="base64.html">Img â†’ Base64</a></li>
    <li><a href="scala-grigi.html">Scala di Grigi</a></li>
  </ul>
</nav>

<main>
  <h1>Ruota immagini online con multitasking e interazione</h1>
  <p class="description">Carica immagini JPG o PNG. Se ne carichi piÃ¹ di una, scegli rotazioni fisse sotto ogni immagine. Se ne carichi una sola, ruotala liberamente con mouse o dito.</p>

  <div id="banner"></div>

  <input type="file" id="inputFiles" accept="image/png, image/jpeg" multiple />

  <div id="multiContainer" aria-live="polite" aria-label="Seleziona rotazioni per ogni immagine"></div>

  <div id="singleContainer" aria-live="polite" aria-label="Interazione immagine singola">
    <img id="singleImg" src="" alt="Immagine da ruotare" />
    <div id="singleRotationValue">Rotazione: 0Â°</div>
  </div>

  <button id="rotateBtn">Ruota e Scarica</button>

  <div id="resultContainer"></div>
</main>

<script>
  const inputFiles = document.getElementById('inputFiles');
  const multiContainer = document.getElementById('multiContainer');
  const singleContainer = document.getElementById('singleContainer');
  const singleImg = document.getElementById('singleImg');
  const singleRotationValue = document.getElementById('singleRotationValue');
  const rotateBtn = document.getElementById('rotateBtn');
  const banner = document.getElementById('banner');
  const resultContainer = document.getElementById('resultContainer');

  let loadedFiles = [];
  let singleRotation = 0;

  function updateBanner() {
    if(loadedFiles.length === 0) {
      banner.style.display = 'none';
      multiContainer.style.display = 'none';
      singleContainer.style.display = 'none';
      rotateBtn.style.display = 'none';
      return;
    }
    banner.style.display = 'block';
    banner.textContent = `Hai caricato ${loadedFiles.length} immagine${loadedFiles.length > 1 ? 'i' : ''}.`;

    rotateBtn.style.display = 'block';

    if(loadedFiles.length === 1) {
      multiContainer.style.display = 'none';
      singleContainer.style.display = 'flex';
      singleRotation = 0;
      singleRotationValue.textContent = `Rotazione: ${singleRotation}Â°`;
      singleImg.style.transform = `rotate(0deg)`;
      // Carica immagine singola
      const reader = new FileReader();
      reader.onload = e => {
        singleImg.src = e.target.result;
      };
      reader.readAsDataURL(loadedFiles[0]);
    } else {
      singleContainer.style.display = 'none';
      multiContainer.style.display = 'flex';
      multiContainer.innerHTML = '';
      loadedFiles.forEach((file, i) => {
        const reader = new FileReader();
        reader.onload = e => {
          const div = document.createElement('div');
          div.className = 'multiItem';
          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = file.name;

          const select = document.createElement('select');
          select.setAttribute('aria-label', `Rotazione immagine ${file.name}`);
          select.dataset.index = i;

          const degrees = [0, 90, 180, 270, 360];
          degrees.forEach(deg => {
            const option = document.createElement('option');
            option.value = deg;
            option.textContent = deg + 'Â°';
            select.appendChild(option);
          });
          // Opzione personalizzata
          const customOption = document.createElement('option');
          customOption.value = 'custom';
          customOption.textContent = 'Personalizzato';
          select.appendChild(customOption);

          const inputCustom = document.createElement('input');
          inputCustom.type = 'number';
          inputCustom.min = 0;
          inputCustom.value = 0;
          inputCustom.style.display = 'none';
          inputCustom.placeholder = 'Â° Personalizzato';
          inputCustom.dataset.index = i;
          inputCustom.style.marginTop = '6px';
          inputCustom.style.borderRadius = '6px';
          inputCustom.style.padding = '6px 8px';
          inputCustom.style.border = 'none';
          inputCustom.style.fontWeight = 'bold';
          inputCustom.style.backgroundColor = '#1db954';
          inputCustom.style.color = '#121212';
          inputCustom.style.textAlign = 'center';

          select.addEventListener('change', () => {
            if(select.value === 'custom') {
              inputCustom.style.display = 'block';
            } else {
              inputCustom.style.display = 'none';
              inputCustom.value = select.value;
            }
          });

          inputCustom.addEventListener('input', () => {
            select.value = 'custom';
          });

          div.appendChild(img);
          div.appendChild(select);
          div.appendChild(inputCustom);

          multiContainer.appendChild(div);
        };
        reader.readAsDataURL(file);
      });
    }
  }

  inputFiles.addEventListener('change', e => {
    loadedFiles = Array.from(e.target.files).filter(f => f.type.startsWith('image/'));
    resultContainer.innerHTML = '';
    updateBanner();
  });

  // Drag rotation for single image
  let dragging = false;
  let startX = 0;
  let lastRotation = 0;

  function clampAngle(angle) {
    return ((angle % 360) + 360) % 360;
  }

  function updateSingleRotationDisplay() {
    singleRotationValue.textContent = `Rotazione: ${Math.round(singleRotation)}Â°`;
    singleImg.style.transform = `rotate(${singleRotation}deg)`;
  }

  singleImg.addEventListener('mousedown', e => {
    e.preventDefault();
    dragging = true;
    startX = e.clientX;
    lastRotation = singleRotation;
    singleImg.style.cursor = 'grabbing';
  });

  window.addEventListener('mouseup', () => {
    if(dragging) {
      dragging = false;
      singleImg.style.cursor = 'grab';
    }
  });

  window.addEventListener('mousemove', e => {
    if(dragging) {
      const deltaX = e.clientX - startX;
      singleRotation = clampAngle(lastRotation + deltaX);
      updateSingleRotationDisplay();
    }
  });

  // Touch events for mobile
